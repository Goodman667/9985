# 新功能说明 New Features

本文档介绍最新添加的功能和改进。

## 🎉 主要新功能

### 1. 📹 智能动作姿态检测

使用TensorFlow.js PoseNet模型，通过摄像头实时检测用户的身体姿态和活动水平，为心理健康评估提供额外的维度。

#### 功能特点

- **实时姿态识别**: 使用PoseNet模型检测17个关键身体点
- **活动水平监测**: 追踪用户的移动频率和活动强度
- **姿态评分**: 评估用户的坐姿和身体状态
- **动作计数**: 统计测评期间的身体移动次数

#### 临床意义

- **低活动水平** → 可能提示疲劳、缺乏动力
- **不良姿态** → 可能提示情绪低落、自信心不足
- **过度动作** → 可能提示焦虑、烦躁不安

#### 使用方法

1. 选择评估量表后，会出现"智能动作姿态检测"卡片
2. 点击"开启摄像头检测"按钮
3. 授权浏览器访问摄像头
4. 系统会显示实时视频和骨架叠加
5. 三个指标会实时更新：
   - **活动水平**: 0-100%，表示移动的频繁程度
   - **姿态评分**: 0-100%，表示身体姿态的健康程度
   - **动作次数**: 累计的身体移动次数

#### 技术实现

- 前端: TensorFlow.js + PoseNet模型
- 模型: MobileNetV1（轻量级，速度快）
- 更新频率: 每秒1次
- 数据传输: JSON格式提交到后端

### 2. 🔄 动态量表切换

修复了之前的bug，现在可以正确地根据选择的量表动态加载不同的问题。

#### 改进内容

- **动态问题加载**: 根据选择的量表自动加载对应的问题
- **问题数量适配**: 支持不同数量的问题（7题、9题、20题等）
- **实时搜索**: 快速搜索和筛选量表
- **平滑切换**: 切换量表时，问题会以动画形式加载

#### 支持的量表

| 量表代码 | 量表名称 | 题数 | 说明 |
|---------|---------|-----|------|
| PHQ-9 | 患者健康问卷 | 9题 | 抑郁症筛查 |
| GAD-7 | 广泛性焦虑症量表 | 7题 | 焦虑症筛查 |
| PSQI | 匹兹堡睡眠质量指数 | 19题 | 睡眠质量评估 |
| HAMA | 汉密尔顿焦虑量表 | 14题 | 焦虑症评估 |
| HAMD | 汉密尔顿抑郁量表 | 17题 | 抑郁症评估 |
| SAS | 自评焦虑量表 | 20题 | 焦虑水平自评 |
| SDS | 自评抑郁量表 | 20题 | 抑郁水平自评 |
| PCL-5 | 创伤后应激障碍清单 | 20题 | PTSD评估 |
| MoCA | 蒙特利尔认知评估 | 30题 | 认知功能筛查 |

#### 技术实现

- 后端: 新增Question实体和QuestionRepository
- API端点: `/questions?questionnaireCode={code}`
- 前端: AJAX动态加载和渲染

### 3. 🎨 全新现代化界面

完全重新设计的用户界面，提供更好的视觉体验和用户体验。

#### 设计特点

- **渐变背景**: 优雅的紫色渐变背景
- **玻璃形态**: 半透明的卡片效果
- **流畅动画**: 淡入、滑入等多种动画效果
- **响应式设计**: 完美适配手机、平板和桌面
- **现代按钮**: 带阴影和悬浮效果的按钮
- **清晰层次**: 使用卡片和颜色区分不同功能区域

#### UI改进细节

- **问题卡片**: 左侧彩色边框，浅色背景，更易阅读
- **选项按钮**: 大号按钮，选中后有渐变背景
- **特征卡片**: 白色卡片配淡蓝色边框，清晰区分
- **状态指示**: 颜色编码的状态和风险等级
- **图表展示**: 更专业的趋势图表样式

#### 色彩系统

- **主色**: #667eea (蓝紫色)
- **次色**: #764ba2 (深紫色)
- **成功**: #4CAF50 (绿色)
- **警告**: #FF9800 (橙色)
- **危险**: #F44336 (红色)

### 4. ⚙️ 配置优化

改进了配置文件，提供清晰的说明和示例。

#### 改进内容

- **详细注释**: 每个配置项都有中文说明
- **多平台支持**: 提供Linux/Mac/Windows的不同配置
- **配置指南**: 新增CONFIG_GUIDE.md详细配置文档
- **默认安全**: 外部服务默认禁用，避免配置错误

#### 新增配置项

```properties
# 摄像头检测配置
ai.camera.enabled=true
ai.camera.update.interval=5000

# API密钥配置说明
ai.baidu.api.key=YOUR_BAIDU_API_KEY
ai.baidu.api.secret=YOUR_BAIDU_API_SECRET
ai.openai.api.key=YOUR_OPENAI_API_KEY
```

### 5. 🔧 OpenSMILE路径修复

修复了OpenSMILE路径配置问题。

#### 问题

- 之前使用Windows绝对路径，在Unix/Linux系统无法使用
- 配置类型格式不正确

#### 解决方案

- 修改为Unix风格路径: `/usr/local/bin/SMILExtract`
- 修正配置类型: `eGeMAPSv02`
- 提供多平台配置示例
- 默认禁用，避免未安装时报错

## 🚀 使用新功能

### 快速开始

1. **启动应用**:
   ```bash
   cd phq9-assessment-feat-voice-detection-multi-scale-search-online-ai
   ./mvnw spring-boot:run
   ```

2. **访问应用**:
   ```
   http://localhost:8080
   ```

3. **选择量表**:
   - 使用下拉框选择
   - 或使用搜索框快速查找

4. **启用摄像头检测**（可选）:
   - 点击"开启摄像头检测"
   - 授权浏览器访问摄像头
   - 观察实时姿态检测

5. **填写问卷**:
   - 根据提示选择选项
   - 可以录制语音
   - 可以输入文字感受

6. **提交分析**:
   - 点击"开始智能分析"
   - 查看多维度AI分析结果

## 📱 移动端优化

新界面完全支持移动设备：

- **响应式布局**: 自动适配屏幕尺寸
- **触摸优化**: 按钮和输入框大小适合触摸
- **垂直布局**: 在小屏幕上自动切换为单列布局
- **性能优化**: 轻量级动画，流畅运行

## 🎯 临床价值

### 多模态评估

结合多种输入方式，提供更全面的评估：

1. **传统问卷** - 标准化评分
2. **语音分析** - 情感和语调特征
3. **文字分析** - 情感倾向和关键词
4. **姿态分析** - 身体活动和姿态指标

### 客观化指标

通过姿态检测添加客观指标：

- **活动水平** - 量化患者的精力和动力
- **姿态质量** - 反映自信心和情绪状态
- **运动模式** - 识别焦虑或烦躁的迹象

### 人文关怀

- **可视化反馈**: 让患者看到系统在关注他们
- **交互体验**: 不只是填表，而是参与式评估
- **即时反馈**: 实时显示检测状态

## 🔐 隐私和安全

### 数据处理

- **本地处理**: 摄像头数据仅在浏览器处理
- **不上传视频**: 只传输分析后的数值数据
- **临时存储**: 语音和视频不会永久保存
- **加密传输**: 使用HTTPS保护数据传输

### 用户控制

- **明确授权**: 需要用户明确授权摄像头访问
- **可选功能**: 所有高级功能都是可选的
- **随时停止**: 用户可随时停止检测

## 🐛 已知问题

1. **浏览器兼容性**:
   - 推荐使用Chrome、Edge、Safari
   - Firefox对PoseNet支持较好
   - IE不支持

2. **性能考虑**:
   - 姿态检测需要较好的CPU
   - 在低端设备上可能略慢
   - 建议关闭其他占用资源的标签页

3. **光线要求**:
   - 需要足够的光线进行姿态检测
   - 避免强逆光
   - 背景简单效果更好

## 📈 未来计划

### 短期（1-3个月）

- [ ] 添加更多量表的预置问题
- [ ] 支持自定义量表
- [ ] 改进姿态分析算法
- [ ] 添加情绪识别（基于面部表情）
- [ ] 导出PDF报告功能

### 中期（3-6个月）

- [ ] 多用户管理系统
- [ ] 医生端控制台
- [ ] 长期追踪和比较
- [ ] 移动端原生应用
- [ ] 更多语言支持

### 长期（6-12个月）

- [ ] 深度学习模型优化
- [ ] 联邦学习隐私保护
- [ ] 临床研究数据集成
- [ ] 可穿戴设备集成
- [ ] 虚拟治疗师助手

## 💬 反馈和建议

欢迎提供反馈和建议：

- **GitHub Issues**: 报告bug或请求新功能
- **邮件**: 发送建议到项目维护者
- **社区讨论**: 参与技术讨论

## 📚 相关文档

- `README.md` - 项目总体介绍
- `CONFIG_GUIDE.md` - 详细配置指南
- `OPENSMILE_SETUP.md` - OpenSMILE安装配置
- `AI_FEATURES.md` - AI功能详细说明

---

*最后更新: 2024*
*版本: v2.0 - 多模态AI增强版*
