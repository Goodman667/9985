# 🤖 PHQ-9智能评估系统 - AI/ML功能说明

## 概述
本项目已升级为基于人工智能和机器学习的智能化PHQ-9抑郁症自评系统，融合了多种AI技术以提供更准确、更个性化的评估和建议。

## 🎯 核心AI/ML功能

### 1. 机器学习风险预测模型
**技术实现：** `MachineLearningService`
- **多维度风险评分**：不仅基于总分，还综合考虑答题模式、情感分析结果等多个维度
- **风险模式检测**：智能识别高危答题模式（如问题9的自杀意念、多个高分项组合等）
- **一致性分析**：使用统计学方法检测答题的一致性和可靠性
- **算法**：基于Apache Commons Math实现的加权评分算法

**特色：**
- 综合风险评分（0-100%）
- 五级风险等级分类
- 比传统PHQ-9评分更敏感的风险识别

### 2. NLP情感分析
**技术实现：** `SentimentAnalysisService`
- **中文情感词典**：内置丰富的中文情感词汇库（消极词汇、积极词汇）
- **关键词提取**：自动识别抑郁、焦虑相关的关键情绪词汇
- **情感倾向打分**：-1.0（极度消极）到 +1.0（极度积极）
- **算法**：基于词典的情感分析算法

**应用场景：**
- 用户可以自由输入文字描述当前感受
- AI自动分析文字中的情感色彩
- 检测到的消极词汇和关键标签会在结果页展示

### 3. 智能推荐系统
**技术实现：** `RecommendationService`
- **个性化干预推荐**：根据每个问题的答案生成针对性建议
- **优先级分级**：紧急、高、中、低四级优先级
- **多领域推荐**：
  - 睡眠改善计划
  - 行为激活疗法
  - 正念冥想练习
  - 认知行为疗法资源
  - 营养与饮食建议
  - 运动疗法
  - 情绪日记
  - 危机干预资源
  - 社会支持网络

**特色：**
- 每个推荐都包含具体的实施方法
- 根据情感分析结果动态调整推荐
- 高风险情况下自动触发危机干预

### 4. 异常检测系统
**技术实现：** `AnomalyDetectionService`
- **答题模式分析**：
  - 检测所有答案相同（可能未认真作答）
  - 识别严格规律模式（递增/递减）
  - 发现矛盾答案（前后不一致）
  - 检测极端响应（过多最高分）

**价值：**
- 提高评估质量和可信度
- 提醒用户仔细作答
- 为专业人员提供数据质量参考

### 5. 趋势分析与预测
**技术实现：** `MachineLearningService.analyzeTrend()`
- **历史数据追踪**：自动保存每次评估记录
- **趋势识别**：判断改善中、稳定、恶化中三种趋势
- **线性回归预测**：预测下次评分
- **可视化图表**：使用Chart.js展示评分趋势曲线

**算法：**
- 最小二乘法线性回归
- 描述性统计分析（均值、标准差）

### 6. 用户聚类分析
**技术实现：** `MachineLearningService.clusterUser()`
- **智能分群**：将用户归类到不同风险群体
  - 低风险群体
  - 轻度风险群体
  - 中度风险群体
  - 高风险群体
  - 严重风险群体
- **定制化干预策略**：每个群体对应特定的干预建议

### 7. 数据持久化与会话管理
**技术实现：** JPA + H2数据库
- **自动保存**：每次评估自动保存到数据库
- **用户识别**：基于Session的用户ID
- **历史查询**：支持查询用户的历史评估记录

## 🛠️ 技术栈

### 后端技术
- **Spring Boot 2.7.5**：Web框架
- **Spring Data JPA**：数据持久化
- **H2 Database**：内存数据库
- **Apache Commons Math3**：数学和统计计算
- **Apache Commons Text**：文本处理

### 前端技术
- **Thymeleaf**：模板引擎
- **Chart.js 3.9.1**：数据可视化
- **现代CSS**：渐变背景、动画效果

## 📊 数据模型

### AssessmentRecord（评估记录实体）
```java
- id: 主键
- userId: 用户标识
- q1-q9: 9个问题的答案
- totalScore: 总分
- level: 风险等级
- sentimentText: 用户输入的文字
- sentimentScore: 情感分析得分
- mlRiskScore: ML风险评分
- anomalyDetected: 是否检测到异常
- createdAt: 创建时间
```

## 🎨 用户界面特色

1. **现代化设计**：紫色渐变背景，卡片式布局
2. **AI标识**：明显的"AI + 机器学习驱动"标识
3. **多维度结果展示**：
   - 传统PHQ-9评分
   - ML综合风险评分（百分比）
   - 情感分析结果（带词汇高亮）
   - 智能分群结果
   - 趋势图表（多次评估后显示）
   - 异常检测警告
   - AI智能推荐列表

4. **交互式元素**：
   - 悬停动画效果
   - 优先级颜色编码
   - 响应式设计

## 🚀 使用方法

### 启动应用
```bash
mvn spring-boot:run
```

### 访问地址
```
http://localhost:8080
```

### H2数据库控制台（开发调试）
```
http://localhost:8080/h2-console
JDBC URL: jdbc:h2:mem:phq9db
Username: sa
Password: (留空)
```

## 🔬 算法详解

### 1. ML风险评分算法
```
总风险 = 基础风险(50%) + 模式风险(25%) + 情感风险(15%) + 一致性风险(10%)

其中：
- 基础风险 = 总分 / 27
- 模式风险考虑高危问题、高分项数量、问题组合等
- 情感风险基于NLP分析的消极程度
- 一致性风险检测答题的可靠性
```

### 2. 情感分析算法
```
1. 遍历文本，匹配情感词典
2. 累加情感权重
3. 归一化到[-1, 1]区间
4. 分类：< -0.3为消极，> 0.3为积极，其他为中性
```

### 3. 趋势预测算法
```
使用最小二乘法计算线性回归：
y = ax + b
其中a为斜率，表示变化趋势
预测值 = 最近一次得分 + 斜率
```

## 📈 未来扩展方向

1. **深度学习模型**：引入TensorFlow或DL4J进行更复杂的预测
2. **自然语言生成**：AI自动生成更个性化的建议文字
3. **多模态分析**：结合语音、面部表情等数据
4. **预警系统**：实时监控用户状态变化，主动推送关怀
5. **社交网络分析**：分析用户社交支持网络的健康度
6. **迁移学习**：使用预训练的中文NLP模型（如BERT）

## ⚠️ 重要声明

本系统仅供参考和辅助使用，不能替代专业医疗诊断。所有AI/ML功能都是基于统计模型和规则，可能存在误差。如有严重抑郁症状，请务必咨询专业医生。

## 📝 许可证

本项目为示例项目，仅供学习和研究使用。

---

**开发者提示：** 本系统展示了如何在传统的Web应用中融入AI/ML功能，提升用户体验和服务质量。代码结构清晰，易于扩展和维护。
